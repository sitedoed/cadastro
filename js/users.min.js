/*!
 *  Functions for getting current user and signing out.
 */
(function(d){window.currentUser={isLoggedWaitList:[],logout:function(){return d.ajax({type:"DELETE",url:"/usersplugin/session"}).done(function(){window.location.reload(true)}).fail(function(){Cookies.remove("accessToken",{path:"/"})}).always(function(){delete currentUser.data})},get:function(){return d.ajax({url:"/usersplugin/session",dataType:"json"}).done(function(e){currentUser.data=e}).always(function(){c()})},isLogged:function(){var f=this;var e=d.Deferred();if(currentUser.data){e.resolve(currentUser.data)}else{if(Cookies.get("accessToken")){f.isLoggedWaitList.push(e);var g=(f.isLoggedWaitList.length===1);if(g){currentUser.get().always(function(){for(var h=0;h<f.isLoggedWaitList.length;h++){f.isLoggedWaitList[h].resolve(currentUser.data)}f.isLoggedWaitList=[]})}}else{e.resolve(null)}}return e.promise()}};function c(){if(currentUser.data){b()}else{a()}}function b(){var e=currentUser.data;d(".loggedout").hide();d(".loggedin").show();var f=e.firstName||e.displayName||e.email;var g=e.email||e.displayName;d("span.user-info-short").text(f);d("span.user-info-long").text(g)}function a(){d(".loggedin").hide();d(".loggedout").show()}currentUser.isLogged().always(function(e){c()})})(jQuery);